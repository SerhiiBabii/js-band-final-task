(this["webpackJsonpjs-band-final-task"]=this["webpackJsonpjs-band-final-task"]||[]).push([[0],{29:function(e,t,n){e.exports=n(40)},39:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(15),o=n.n(c),l=n(2),u=n(10),s=n(9),i=function(e,t,n){return{type:"SIGNIN",username:e,avatar:t,token:n}},m=Object(l.b)((function(e){return{user:e.books.user}}),(function(e){return{signOutUser:function(){return e({type:"SIGNUOT"})}}}))((function(e){var t=e.user,n=e.signOutUser,a=t.username,c=t.avatar;return r.a.createElement("div",null,r.a.createElement(u.b,{to:"/cart"},r.a.createElement("img",{height:"40",src:"./images/cart.svg",alt:"cart"})),r.a.createElement("button",{onClick:n,type:"button",className:"btn btn-primary m-2"},"Sing-Out"),r.a.createElement("img",{height:"40",className:"m-2 rounded-circle",src:c,alt:"avatar"}),r.a.createElement("span",null,a))})),f=Object(l.b)((function(e){return{user:e.books.user}}))((function(e){var t=e.user;return r.a.createElement("nav",{className:"navbar navbar-dark"},r.a.createElement("h3",null,"JS BAND STORE / Serhii Babii"),t.username?r.a.createElement(m,null):null)})),d=function(){return r.a.createElement("div",{className:"text-center"},r.a.createElement("img",{className:"text-center",height:"80",src:"./images/cart.svg",alt:"empty cart"}),r.a.createElement("p",null,"Cart empty."))},b=function(e){var t=e.currentCart,n=t.title,a=t.count,c=t.total;return r.a.createElement("tr",{className:"row"},r.a.createElement("td",{className:"col-7"},n),r.a.createElement("td",{className:"col-4"},a),r.a.createElement("td",{className:"col-1"},c))};b.defaultProps={currentCart:{},title:"",count:0,total:0};var p=b,E=function(e){var t=e.orderTotal;return r.a.createElement("div",null,r.a.createElement("b",null,"Total price, $",t))},v=Object(l.b)((function(e){return{cartItems:e.books.cart.cartItems,orderTotal:e.books.cart.orderTotal}}))((function(e){var t=e.cartItems,n=e.orderTotal;return r.a.createElement("div",null,r.a.createElement("table",{className:"table m-3"},r.a.createElement("tbody",null,t?t.map((function(e){return r.a.createElement(p,{key:e.id,currentCart:e})})):null)),r.a.createElement(E,{orderTotal:n}))})),g=n(26),k=n(27),h="https://js-band-api.glitch.me",O=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,a){fetch(e,t).then((function(e){if(e.status<400)return e.json();throw e})).then((function(e){n(e)})).catch((function(e){e.json().then((function(e){a(e)}))}))}))},N=function(){function e(){Object(g.a)(this,e)}return Object(k.a)(e,null,[{key:"get",value:function(e,t){return O("".concat(h).concat(e),{mode:"cors",headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(t)}})}},{key:"post",value:function(e,t){return O("".concat(h).concat(e),{method:"POST",mode:"cors",headers:{"Content-type":"application/json",Accept:"application/json"},body:JSON.stringify(t)})}},{key:"postWithToken",value:function(e,t,n){return O("".concat(h).concat(e),{method:"POST",mode:"cors",headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(t),Accept:"application/json"},body:JSON.stringify(n)})}}]),e}(),S=Object(l.b)((function(e){return{cartItems:e.books.cart.cartItems,token:e.books.user.token}}),(function(e){return{purchase:function(){return e({type:"SEND_BOOKS"})}}}))((function(e){var t=e.cartItems,n=e.token,a=e.purchase;return r.a.createElement("div",null,r.a.createElement("div",{className:"text-right"},r.a.createElement("button",{onClick:function(){!function(e,t,n){N.postWithToken("/purchase",t,{books:e}).then((function(){n()}))}(t,n,a)},disabled:!t.length,className:"btn btn-primary",type:"button"},"Purchase")),t.length?r.a.createElement(v,null):r.a.createElement(d,null))})),y=n(14),j=Object(l.b)(null,(function(e){return{addBookToCart:function(t,n){return e(function(e,t){return{type:"ADD_BOOK",bookId:e,quantity:t}}(t,n))}}}))((function(e){var t=e.id,n=e.price,c=e.maxBooks,o=e.addBookToCart,l=Object(a.useState)(1),u=Object(y.a)(l,2),s=u[0],i=u[1];return r.a.createElement("div",{className:"border p-2"},r.a.createElement("p",{className:"row"},r.a.createElement("span",{className:"col-8"},"Price, $"),r.a.createElement("span",{className:"col-2"},n)),r.a.createElement("div",{className:"row"},r.a.createElement("span",{className:"col-8"},"Count"),r.a.createElement("input",{className:"col-3 rounded pl-2 pr-0",value:s,type:"number",name:"countInput",onChange:function(e){return e.target.value<0?1:e.target.value>c?e.target.value:i(e.target.value)}})),r.a.createElement("p",{className:"row"},r.a.createElement("span",{className:"col-8"},"Total price "),r.a.createElement("span",{className:"col-2"},(n*s).toFixed(2))),r.a.createElement("div",{className:"text-right"},r.a.createElement("button",{onClick:function(){return o(t,s)},disabled:s<1,className:"btn btn-secondary",type:"button"},"Add to cart")))})),_=(n(39),function(){return r.a.createElement("div",{className:"lds-css ng-scope"},r.a.createElement("div",{className:"lds-wedges"},r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("div",null)),r.a.createElement("div",null,r.a.createElement("div",null)),r.a.createElement("div",null,r.a.createElement("div",null)),r.a.createElement("div",null,r.a.createElement("div",null)))))}),B=Object(l.b)((function(e){return{book:e.books.book,loading:e.books.loading,token:e.books.user.token}}),(function(e){return{fetchBookRequest:function(){return e({type:"FETCH_BOOK_REQUEST"})},fetchBookSuccess:function(t){return e(function(e){return{type:"FETCH_BOOK_SUCCESS",book:e}}(t))},fetchBookFailure:function(t){return e(function(e){return{type:"FETCH_BOOK_FAILURE",error:e}}(t))}}}))((function(e){var t=e.match,n=e.token,c=e.loading,o=e.book,l=e.book,u=l.id,s=l.title,i=l.author,m=l.description,f=l.cover,d=l.tags,b=l.level,p=l.count,E=l.price,v=e.fetchBookSuccess,g=e.fetchBookRequest;e.fetchBookFailure;Object(a.useEffect)((function(){N.get("/books/".concat(t.params.id),n).then((function(e){g(),setTimeout((function(){return v(e)}),2e3)}))}),[g,v,t.params.id,n]);var k=f||"./images/imageNotFound.png";return o.title&&!c?r.a.createElement("div",{className:"m-3"},r.a.createElement("div",{className:"row"},r.a.createElement("img",{className:"col-4",src:k,alt:"poster"}),r.a.createElement("div",{className:"col-4"},r.a.createElement("p",null,"Book name:"," ",s),r.a.createElement("p",null,"Book author:"," ",i),r.a.createElement("p",null,"Book level:"," ",b),r.a.createElement("p",null,"Book tags:"," ",d)),r.a.createElement("div",{className:"col-4"},r.a.createElement(j,{id:u,price:E,maxBooks:p}))),r.a.createElement("p",null,"Description:",m)):r.a.createElement(_,null)})),C=Object(l.b)(null,(function(e){return{signInUser:function(t,n,a){return e(i(t,n,a))}}}))((function(e){var t=e.signInUser,n=Object(a.useState)(""),c=Object(y.a)(n,2),o=c[0],l=c[1],u=Object(a.useState)("error"),s=Object(y.a)(u,2),i=s[0],m=s[1];return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-12 text-center"},r.a.createElement("div",null,r.a.createElement("img",{className:"border",height:"250",src:"images/defaultAvatar.png",alt:"avatar"})),r.a.createElement("div",{className:"m-2"},r.a.createElement("label",{htmlFor:"username"},r.a.createElement("p",{className:"mb-0"},r.a.createElement("b",null,"Username")),r.a.createElement("input",{value:o,onChange:function(e){l(e.target.value),e.target.value.length<4||e.target.value.length>16?m("error"):m("")},className:"col-12",type:"text",name:"username",id:"username",placeholder:"type Username"})),i?r.a.createElement("p",{className:"text-danger"},"Field is not valid"):null),r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e=o,n=t,void N.post("/signin",{username:e}).then((function(e){var t=e.username,a=e.avatar,r=e.token;n(t,a,r)}));var e,n},disabled:!!i,className:"col-2",type:"button"},"Sign-In"))))})),T=function(){return r.a.createElement("div",{className:"text-center"},r.a.createElement("img",{className:"col-8",src:"./images/error404.jpg",alt:"error404"}))},I=function(e){var t=e.book,n=t.id,a=t.cover,c=t.title,o=t.author,l=t.price,s=a||"images/imageNotFound.png";return r.a.createElement("div",{className:"cart row col-3 border m-4 p-3"},r.a.createElement("img",{className:"col-12",src:s,alt:"cover"}),r.a.createElement("p",{className:"col-12"},c),r.a.createElement("p",{className:"col-12"},o),r.a.createElement("p",{className:"row col-12"},r.a.createElement("span",{className:"col-8"},"Price:"," ",l),r.a.createElement(u.b,{to:"/books/".concat(n),className:"btn btn-secondary col-4"},"View")))},F=Object(l.b)((function(e){return{search:e.books.filters.search,price:e.books.filters.price}}),(function(e){return{onChangeFilter:function(t,n){return e(function(e,t){return{type:"SHOW_FILTERED_BOOKS",name:e,value:t}}(t,n))}}}))((function(e){var t=e.search,n=e.price,a=e.onChangeFilter;return r.a.createElement("div",{className:"form-group row"},r.a.createElement("input",{onChange:function(e){return a(e.target.name,e.target.value)},value:t,className:"form-control col-6",type:"text",name:"search",placeholder:"Search by book name"}),r.a.createElement("select",{onChange:function(e){return a(e.target.name,e.target.value)},value:n,className:"form-control col-3",name:"price"},r.a.createElement("option",{value:"all"},"all"),r.a.createElement("option",{value:"from_0_to_15"},"0 < price > 15"),r.a.createElement("option",{value:"from_15_to_30"},"15 < price > 30"),r.a.createElement("option",{value:"more_than_30"},"price > 30")))}));var w=function(e,t){return 0===t.length?e:e.filter((function(e){return e.title.toLowerCase().indexOf(t.toLowerCase())>-1}))};var U=function(e,t){return"all"===t?e:"from_0_to_15"===t?e.filter((function(e){return e.price>=0&&e.price<15})):"from_15_to_30"===t?e.filter((function(e){return e.price>=15&&e.price<30})):"more_than_30"===t?e.filter((function(e){return e.price>30})):void 0},x=Object(l.b)((function(e){return{books:e.books.books,token:e.books.user.token,loading:e.books.loading,search:e.books.filters.search,price:e.books.filters.price}}),(function(e){return{fetchBooksRequest:function(){return e({type:"FETCHS_BOOK_REQUEST"})},fetchBooksSuccess:function(t){return e(function(e){return{type:"FETCH_BOOKS_SUCCESS",books:e}}(t))},fetchBooksFailure:function(t){return e(function(e){return{type:"FETCH_BOOKS_FAILURE",error:e}}(t))}}}))((function(e){var t=e.books,n=e.token,c=e.loading,o=e.search,l=e.price,u=e.fetchBooksRequest,s=e.fetchBooksSuccess;e.fetchBooksFailure;Object(a.useEffect)((function(){N.get("/books",n).then((function(e){u(),setTimeout((function(){return s(e)}),2e3)}))}),[u,s,n]);var i=c?r.a.createElement(_,null):null,m=w(U(t,l),o),f=t&&!c?m.map((function(e){return r.a.createElement(I,{key:e.id,book:e})})):null;return r.a.createElement("div",{className:"row p-3"},r.a.createElement("div",{className:"col-10"},r.a.createElement(F,null)),r.a.createElement("div",{className:"row"},i,f))})),K=n(28),P=Object(l.b)((function(e){return{user:e.books.user}}))((function(e){var t=e.component,n=e.user,a=Object(K.a)(e,["component","user"]);return r.a.createElement(s.b,Object.assign({},a,{render:function(e){return n.username?r.a.createElement(t,e):r.a.createElement(s.a,{to:"/signin"})}}))})),R=Object(l.b)(null,(function(e){return{signInUser:function(t,n,a){return e(i(t,n,a))}}}))((function(e){var t=e.signInUser;return Object(a.useEffect)((function(){var e=function(){try{var e=localStorage.getItem("user");if(null===e)return;return JSON.parse(e)}catch(t){return}}().user,n=e.username,a=e.avatar,r=e.token;t(n,a,r)}),[t]),r.a.createElement(u.a,null,r.a.createElement("div",{className:"container"},r.a.createElement("hr",null),r.a.createElement(f,null),r.a.createElement("hr",null),r.a.createElement(s.d,null,r.a.createElement(s.b,{exact:!0,path:"/"},r.a.createElement(s.a,{to:"/signin"})),r.a.createElement(s.b,{path:"/signin",component:C}),r.a.createElement(P,{exact:!0,path:"/books",component:x}),r.a.createElement(P,{path:"/books/:id",component:B}),r.a.createElement(P,{path:"/cart",component:S}),r.a.createElement(s.b,{exact:!0,path:"*",component:T}))))})),D=n(11),H=n(21),A=n(12),L=function(e,t,n){return 0===t.count?[].concat(Object(A.a)(e.slice(0,n)),Object(A.a)(e.slice(n+1))):-1===n?[].concat(Object(A.a)(e),[t]):[].concat(Object(A.a)(e.slice(0,n)),[t],Object(A.a)(e.slice(n+1)))},J=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=t.id,r=void 0===a?e.id:a,c=t.count,o=void 0===c?0:c,l=t.title,u=void 0===l?e.title:l,s=t.total,i=void 0===s?0:s,m=i+n*e.price;return{id:r,count:+o+ +n,title:u,total:+m.toFixed(2)}},q=function(e,t,n){var a=0;return e.map((function(e){return a+=e.total})),a+t.price*n},G=function(e,t,n){var a=n.books,r=n.cart.cartItems,c=a.find((function(t){return t.id===e})),o=r.findIndex((function(t){return t.id===e})),l=r[o],u=J(c,l,t);return{cartItems:L(r,u,o),orderTotal:q(r,c,t).toFixed(2)}};function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){Object(H.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z={user:{username:void 0,avatar:void 0,token:void 0},books:[],book:{},filters:{search:"",price:"all"},cart:{cartItems:[],orderTotal:void 0},loading:!1,error:null},$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SIGNIN":return W({},e,{user:{username:t.username,avatar:t.avatar,token:t.token}});case"SIGNUOT":return W({},e,{user:{username:void 0,avatar:void 0,token:void 0}});case"SHOW_FILTERED_BOOKS":return W({},e,{filters:W({},e.filters,Object(H.a)({},t.name,t.value))});case"FETCHS_BOOK_REQUEST":return W({},e,{books:[],loading:!0,error:null});case"FETCH_BOOKS_SUCCESS":return W({},e,{books:t.books,loading:!1,error:null});case"FETCH_BOOKS_FAILURE":return W({},e,{books:[],loading:!1,error:t.error});case"FETCH_BOOK_REQUEST":return W({},e,{book:{},loading:!0,error:null});case"FETCH_BOOK_SUCCESS":return W({},e,{book:t.book,loading:!1,error:null});case"FETCH_BOOK_FAILURE":return W({},e,{book:{},loading:!1,error:t.error});case"ADD_BOOK":return W({},e,{cart:G(t.bookId,t.quantity,e)});case"SEND_BOOKS":return W({},e,{cart:{cartItems:[],orderTotal:void 0}});default:return e}},V=Object(D.b)({books:$}),M=Object(D.c)(V);M.subscribe((function(){!function(e){try{var t=JSON.stringify(e);localStorage.setItem("user",t)}catch(n){}}({user:M.getState().books.user})}));var X=M;o.a.render(r.a.createElement(l.a,{store:X},r.a.createElement(R,null)),document.getElementById("root"))}},[[29,1,2]]]);
//# sourceMappingURL=main.2f1b90c1.chunk.js.map